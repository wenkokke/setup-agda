#!/usr/bin/env sh

fail="$(mktemp)"

# Check files with pre-commit
echo "Running pre-commit..."
{ pre-commit run --all-files || echo > "$fail"; }

# Build README.md and add to commit:
{ npm run update-readme || echo > "$fail"; }
git add README.md

# Build dist and add to commit:
echo "Building dist..."
{ npm run all || echo > "$fail"; }
git add dist/*
git add src/data/*.json

# Delete 'latest' tag locally:
git tag --delete latest || true

# Check if any of the previous commands failed:
if [ ! -s "$fail" ]
then
    rm "$fail"
    exit 0
else
    rm "$fail"
    exit 1
fi
